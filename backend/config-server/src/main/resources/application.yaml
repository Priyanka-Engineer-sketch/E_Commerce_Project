# =========================
# Spring Cloud Config Server (runs on 8888)
# =========================
server:
  port: 8888

spring:
  application:
    name: config-server

  cloud:
    config:
      server:
        # --------- CHOOSE ONE BACKEND: HTTPS (PAT) OR SSH ---------
        git:
          # (A) HTTPS + PAT (recommended if you don't want SSH)
          # uri is overridden by env: CONFIG_GIT_URI
          uri: ${CONFIG_GIT_URI:https://github.com/Priyanka-Engineer-sketch/ecom-config.git}
          default-label: ${CONFIG_GIT_BRANCH:main}
          search-paths: ${CONFIG_GIT_PATHS:}
          clone-on-start: true
          skip-ssl-validation: ${CONFIG_GIT_SKIP_SSL:false}
          timeout: ${CONFIG_GIT_TIMEOUT:20}
          force-pull: ${CONFIG_GIT_FORCE_PULL:true}
          delete-untracked-branches: true
          username: ${CONFIG_GIT_USERNAME:}    # leave empty if using SSH
          password: ${CONFIG_GIT_PASSWORD:}    # supply via secret manager (do not commit)

          # (B) SSH (uncomment these if you switch to SSH)
          # uri: git@github.com:Priyanka-Engineer-sketch/ecom-config.git
          # private-key: ${CONFIG_GIT_SSH_KEY:}
          # passphrase: ${CONFIG_GIT_SSH_PASSPHRASE:}
          # ignore-local-ssh-settings: ${CONFIG_GIT_IGNORE_LOCAL_SSH:true}
          # strict-host-key-checking: ${CONFIG_GIT_STRICT_HOST_KEY:true}
          # host-key: ${CONFIG_GIT_HOST_KEY:}
          # host-key-algorithm: ${CONFIG_GIT_HOST_KEY_ALGO:}

# Basic auth for Config Server endpoints (optional)
security:
  user:
    name: ${CONFIG_USER:config}
    password: ${CONFIG_PASS:configpass}

# Enable {cipher} support for CLIENT configs stored in ecom-config repo
encrypt:
  key: ${CONFIG_ENCRYPT_KEY:}   # supply via secret; do NOT commit plaintext

logging:
  level:
    root: INFO
    org.springframework.cloud.config.server: INFO
    org.eclipse.jgit: INFO

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true

# Optional: donâ€™t register config-server itself in Eureka
eureka:
  client:
    register-with-eureka: ${EUREKA_REGISTER:false}
    fetch-registry: ${EUREKA_FETCH:false}
    serviceUrl:
      defaultZone: ${EUREKA_SERVER_URL:http://localhost:8761/eureka}
  instance:
    prefer-ip-address: true

# =========================
# Native profile (local folder backend)
# Activate with: --spring.profiles.active=native
# =========================
---
spring:
  config:
    activate:
      on-profile: native
  cloud:
    config:
      server:
        native:
          search-locations:
            - ${CONFIG_NATIVE_DIR:./config-repo}

server:
  port: 8888
